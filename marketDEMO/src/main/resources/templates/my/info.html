<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>마이페이지::나의설정</title>
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/sidebar.css">
    <link rel="stylesheet" href="/css/my/myPage.css">
    <style>
        .sidebar nav a:nth-child(6) {
            text-decoration: underline;
        }
        table.settings{width:100%;border-collapse:collapse;border-top: solid 1px #ccc;}
        table.settings th, table.settings td{padding:10px;text-align:left}
        table.settings tr:nth-last-child(2) th, table.settings tr:nth-last-child(2) td{border-bottom: solid 1px #ccc;}
        table.settings th{width:150px;background:#f9f9f9;white-space:nowrap}
        input[type="text"],input[type="date"],select{height:32px;padding:0 8px;border:1px solid #ccc;box-sizing:border-box}
        input[readonly]{background:#f5f5f5;color:#555}
        .inline{display:inline-flex;align-items:center;gap:6px;flex-wrap:wrap}
        .btn{height:32px;padding:0 12px;border:1px solid #bbb;background:#eee;cursor:pointer}
        .btn--primary{background:#4a72d9;color:#fff;border-color:#4a72d9}
        .btn--danger{background:#c9362b;color:#fff;border-color:#c9362b}
        .btn--sm{height:28px;padding:0 8px;font-size:13px}
        .footer-row td:last-child{text-align:center;padding:20px}
    </style>
</head>
<body>
<!-- ■■■■■ 헤더 ■■■■■ -->
<div class="header-wrap" th:replace="~{my/_header.html}"></div>
<!-- □□□□□ 헤더 □□□□□ -->
<!-- 마이페이지 요약 정보 -->
<!-- DB연결 예정 for each -->
<div style="width: 100%;  background-color: #f2f2f2; display: flex; flex-direction: column; position: sticky; top: 0; height: 100px;max-width: 1920px;
            margin: 0 auto;">
    <div class="summary" style="display: inline-flex; min-width: 1060px; margin: 0 auto; width: 100%;">
        <div style="margin-left: 5%; margin-right: auto; display: flex; align-items: center; height: 100px;">
            <span style="font-size: 24px; font-weight: bold;">나의설정</span>
        </div>
        <div style="width: 25%; margin-right: 5%; display: flex; align-items: center;">
            <table style="border-collapse: collapse; text-align: center; width: 100%; height: 70%;">
                <colgroup>
                    <col style="width: 25%;">
                    <col style="width: 25%;">
                    <col style="width: 25%;">
                    <col style="width: 25%;">
                </colgroup>
                <tr>
                    <th style="border-right: solid 1px #d9d9d9;">주문</th>
                    <th style="border-right: solid 1px #d9d9d9;">쿠폰</th>
                    <th style="border-right: solid 1px #d9d9d9;">포인트</th>
                    <th>문의</th>
                </tr>
                <tr>
                    <td style="border-right: solid 1px #d9d9d9;">[[${userOrderCount}]]</td>
                    <td style="border-right: solid 1px #d9d9d9;">[[${userCouponCount}]]</td>
                    <td style="border-right: solid 1px #d9d9d9;"><span th:text="${#numbers.formatInteger(userPoints, 3, 'COMMA')}"></span></td>
                    <td>[[${userQnaCount}]]</td>
                </tr>
            </table>
        </div>
    </div>
    <!-- ■■■■■ 사이드바 ■■■■■ -->
    <div th:replace="~{my/_sidebar.html}"></div>
    <!-- □□□□□ 사이드바 □□□□□ -->
</div>
<main class="mincheolkang" style="display: flex; flex-wrap: nowrap;">
    <!-- ■■■■■ 사이드바 공간 ■■■■■ -->
    <div style="width: 25%; height: 1px; min-width: 240px;"></div>
    <!-- □□□□□ 사이드바 공간 □□□□□ -->
    <section class="main-content" style="margin-left: 10px;">
        <div class="ad-banner" style="width: 100%; height: 86px; text-align: center;">
            <img src="/images/광고.png" style="width: 810px; height: 100%;">
        </div>
        <article>
            <h3>나의설정</h3>
            <form action="/my/settings" method="post">
                <table class="settings">
                    <tr>
                        <th>사용자 ID</th>
                        <td>chh****<input type="hidden" name="userId" value="chh****"></td>
                    </tr>

                    <tr>
                        <th>비밀번호</th>
                        <td><button type="button" class="btn btn--sm">비밀번호수정</button></td>
                    </tr>

                    <tr>
                        <th>이름</th><td>김 * 학</td>
                    </tr>

                    <tr>
                        <th>생년월일</th><td>1983년 05월 03일</td>
                    </tr>

                    <!-- 이메일 -->
                    <tr>
                        <th>Email</th>
                        <td>
                            <div class="inline">
                                <input id="emailId"    name="emailId"    type="text" style="width:140px" disabled>
                                <span>@</span>
                                <input id="emailDomain" name="emailDomain" type="text" style="width:140px" value="naver.com" disabled>
                                <select id="emailSelect" disabled>
                                    <option value="naver.com">네이버</option>
                                    <option value="gmail.com">지메일</option>
                                    <option value="daum.net">다음</option>
                                    <option value="__custom">직접입력 ▼</option>
                                </select>
                                <button id="emailEditBtn" type="button" class="btn btn--sm">수정하기</button>
                            </div>
                        </td>
                    </tr>

                    <!-- 휴대폰 -->
                    <tr>
                        <th>휴대폰</th>
                        <td>
                            <div class="inline">
                                <input id="hp1" name="hp1" type="text" maxlength="3" style="width:70px" value="010" disabled>
                                <span>-</span>
                                <input id="hp2" name="hp2" type="text" maxlength="4" style="width:90px" disabled>
                                <span>-</span>
                                <input id="hp3" name="hp3" type="text" maxlength="4" style="width:90px" disabled>
                                <button id="phoneEditBtn" type="button" class="btn btn--sm">수정하기</button>
                            </div>
                        </td>
                    </tr>

                    <!-- 주소 (예시는 항상 편집 가능) -->
                    <tr>
                        <th>주소</th>
                        <td>
                            <div class="inline" style="margin-bottom:6px">
                                <input name="zip" type="text" placeholder="우편번호" style="width:140px">
                                <button type="button" class="btn btn--sm">주소검색</button>
                            </div><br>
                            <input name="addr1" type="text" placeholder="기본주소입력" style="width:420px;max-width:100%;margin-bottom:6px"><br>
                            <input name="addr2" type="text" placeholder="상세주소입력" style="width:420px;max-width:100%">
                        </td>
                    </tr>

                    <tr>
                        <th>탈퇴</th>
                        <td><button type="submit" class="btn btn--danger" formaction="/my/leave" formmethod="post">탈퇴 하기</button></td>
                    </tr>

                    <tr class="footer-row">
                        <td colspan="2"><button type="submit" class="btn btn--primary" style="width:160px;height:40px">수정하기</button></td>
                    </tr>
                </table>
            </form>
        </article>
    </section>
</main>

<!-- ■■■■■ 푸터 ■■■■■ -->
<div th:replace="~{my/_footer.html}"></div>
<!-- □□□□□ 푸터 □□□□□ -->
<script>
    // 이메일 선택 처리
    // 이메일: '수정하기' 클릭 시 활성화
    const emailEditBtn  = document.getElementById('emailEditBtn');
    const emailId       = document.getElementById('emailId');
    const emailDomain   = document.getElementById('emailDomain');
    const emailSelect   = document.getElementById('emailSelect');

    emailEditBtn.addEventListener('click', () => {
        [emailId, emailDomain, emailSelect].forEach(el => el.disabled = false);
        // 기본: 선택된 옵션 값을 도메인에 반영
        if (emailSelect.value !== '__custom') {
            emailDomain.value   = emailSelect.value;
            emailDomain.disabled = true; // 선택형일 때는 도메인 입력칸은 잠금
        }
        emailId.focus();
    });

    // 도메인 선택: '직접입력'이면 도메인칸 활성화, 아니면 값 세팅하고 잠금
    emailSelect.addEventListener('change', () => {
        if (emailSelect.disabled) return; // 아직 비활성 상태면 무시
        if (emailSelect.value === '__custom') {
            emailDomain.disabled = false;
            emailDomain.value = '';
            emailDomain.focus();
        } else {
            emailDomain.value   = emailSelect.value;
            emailDomain.disabled = true;
        }
    });

    // 휴대폰: '수정하기' 클릭 시 활성화
    const phoneEditBtn = document.getElementById('phoneEditBtn');
    const hp1 = document.getElementById('hp1');
    const hp2 = document.getElementById('hp2');
    const hp3 = document.getElementById('hp3');

    phoneEditBtn.addEventListener('click', () => {
        [hp1, hp2, hp3].forEach(el => el.disabled = false);
        (hp1.value ? (hp2.value ? hp3 : hp2) : hp1).focus(); // 입력 진행 위치에 포커스
    });
</script>

<!-- <%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%> -->
<!-- 강민철 2025-10-21 1214 -->
