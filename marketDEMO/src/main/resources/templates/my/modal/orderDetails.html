<article id="orderDetails" class="modal">
    <div class="modal-window">
        <div class="modal-titleBar">
            <h2>주문상세</h2>
            <p>20xx-12-13</p>
            <span id="closeODModal" class="close">&times</span>
        </div>
        <div class="modal-content">
            <h3>결제정보</h3>
            <table class="payInfo">
                <tbody>
                <tr>
                    <th>총 금액</th>
                    <td>64000원</td>
                </tr>
                <tr>
                    <th>할인금액</th>
                    <td>4000원</td>
                </tr>
                <tr>
                    <th>포인트</th>
                    <td>100원</td>
                </tr>
                </tbody>
                <tfoot>
                <tr>
                    <th>결제금액</th>
                    <td>59900원</td>
                </tr>
                </tfoot>
            </table>
            <h3>주문정보</h3>
            <table class="orderInfo">
                <tbody>
                    <tr>
                        <th>날짜</th>
                        <th colspan="2">상품정보</th>
                        <th>상태</th>
                    </tr>
                </tbody>
            </table>
            <h3>배송정보</h3>
            <table class="delivInfo">
                <tr>
                    <td>이름</td>
                    <td>홍길동</td>
                </tr>
                <tr>
                    <td>연락처</td>
                    <td>010-1234-1001</td>
                </tr>
                <tr>
                    <td>주소</td>
                    <td>[210**] 부산광역시 부산진구 대연동 121 10층 1004호</td>
                </tr>
                <tr>
                    <td>배송요청사항</td>
                    <td>없음</td>
                </tr>
            </table>
        </div>
    </div>
    <!--■■■■■모달 창 스크립트■■■■■-->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const modal = document.getElementById("orderDetails");
            const closeModalButton = document.getElementById("closeODModal");

            const orderInfo = document.getElementsByClassName('orderInfo')[0]
                .getElementsByTagName("tbody")[0];

            document.addEventListener('click', function (e) {
                if (e.target.className === 'orderNum') {
                    e.preventDefault();

                    let u_id = "user01"; // 추후 로그인 연동
                    let po_no = e.target.getAttribute('order');
                    console.log(po_no);

                    fetch(`/my/modal/orderDetail/${u_id}/${po_no}`)
                        .then(response => response.json())
                        .then(data => {
                            console.log(data);

                            for (const item of data) {
                                // 가격 포맷팅: 쉼표 추가
                                const formattedPrice = new Intl.NumberFormat().format(item.p_price);

                                const itemTableRow = `<tr class="orderItem">
                                                            <td>${item.po_orderdate}</td>
                                                            <td><img src="/images/로고.png"/></td>
                                                            <td>
                                                                주문번호 : <span class="orderNum">${item.po_no}</span><br>
                                                                <span class="sellerName">${item.s_company_name}</span><br>
                                                                <span class="productName">${item.p_name}</span><br>
                                                                수량 : <span class="prodQuantity">${item.oi_prod_qty}</span>개<br>
                                                                <b class="unitPrice">${formattedPrice}원</b>
                                                            </td>
                                                            <td>${item.oi_del_status}</td>
                                                        </tr>`;
                                console.log(item);

                                orderInfo.insertAdjacentHTML('beforeend', itemTableRow);
                            }
                        })
                        .catch(err => {
                            console.log(err);
                        });

                    modal.style.display = "block";
                }
            });

            closeModalButton.onclick = function () {
                const orderItems = Array.from(document.getElementsByClassName('orderItem'));

                orderItems.forEach(function(orderItem) {
                    orderItem.remove();
                });
                modal.style.display = "none";
            }
        });
    </script>
</article>