<th:block th:fragment="content">
    <link rel="stylesheet" href="/css/admin/recruit-list.css">
    <link rel="stylesheet" href="/css/admin/modal.css">
    <!-- ■■■■■ 메인컨텐츠 시작 ■■■■■ -->
    <div class="page">
        <div class="topbar">
            <h4>채용하기 목록</h4>
            <div class="breadcrumb">HOME &gt; 고객센터 &gt; <b>채용하기</b></div>
        </div>

        <!-- 검색 -->
        <div class="search-row">
            <select name="searchType" id="searchType">
                <option value="r_no">번호</option>
                <option value="r_dept">채용부서</option>
                <option value="r_type">채용형태</option>
                <option value="r_title">제목</option>
            </select>
            <input type="text" name="keyword" placeholder="검색어입력" />
            <button class="btn" type="button">검색</button>
        </div>


        <!-- 목록 -->
        <table>
            <thead>
            <tr>
                <th class="col-check"><input type="checkbox" id="chkAll"></th>
                <th>번호</th>
                <th>채용부서</th>
                <th>경력사항</th>
                <th>채용형태</th>
                <th>제목</th>
                <th>작성자</th>
                <th>상태</th>
                <th>모집기간</th>
                <th>작성일</th>
            </tr>
            </thead>
            <tbody>
            <!--                <tr>-->
            <!--                    <td class="col-check"><input type="checkbox"></td>-->
            <!--                    <td>120</td>-->
            <!--                    <td>광고사업</td>-->
            <!--                    <td>경력 4 ~ 15년</td>-->
            <!--                    <td>정규직</td>-->
            <!--                    <td>광고 프로젝트 기획</td>-->
            <!--                    <td>관리자</td>-->
            <!--                    <td class="status">모집중</td>-->
            <!--                    <td class="col-date">0000-00-00 ~ 0000-00-00</td>-->
            <!--                    <td class="col-date">0000-00-00</td>-->
            <!--                </tr>-->

            <tr th:each="recruitment : ${list}">
                <td class="col-check">
                    <input type="checkbox" th:value="${recruitment.r_no}">
                </td>
                <td th:text="${recruitment.r_no}"></td>
                <td th:text="${recruitment.r_dept}"></td>
                <td th:text="${recruitment.r_career}"></td>
                <td th:text="${recruitment.r_type}"></td>
                <td th:text="${recruitment.r_title}"></td>
                <td>관리자</td>

                <td class="status"
                    th:text="${recruitment.computedStatus}"
                    th:classappend="${recruitment.computedStatus == '모집중'} ? ' status--open' :
                    (${recruitment.computedStatus == '종료'} ? ' status--closed' : ' status--scheduled')">
                </td>

                <td class="col-date"
                    th:text="|${#temporals.format(recruitment.r_start_date,'yyyy-MM-dd')} ~ ${#temporals.format(recruitment.r_end_date,'yyyy-MM-dd')}|">
                </td>
                <td class="col-date" th:text="${#temporals.format(recruitment.r_reg_date, 'yyyy-MM-dd')}"></td>
            </tr>



            </tbody>

        </table>


        <!-- 테이블 하단 영역 -->
        <div class="table-bottom">
            <div class="left">
                <a href="#" class="btn-gray" id="btnDelete">선택삭제</a>
            </div>

            <div class="center pagination">
                <a href="#">이전</a>
                <a href="#">1</a>
                <a href="#">2</a>
                <a href="#">3</a>
                <a href="#">4</a>
                <a href="#">5</a>
                <a href="#">다음</a>
            </div>

            <div class="right">
                <button class="btn-blue" type="button">채용등록</button>
            </div>
        </div>

        <!-- 채용하기 모달 -->
        <!-- 채용하기 모달 -->
        <div id="Modal" class="modal" aria-hidden="true">
            <div class="modal__backdrop" data-close="true"></div>

            <div class="modal__dialog" role="dialog" aria-modal="true" aria-labelledby="ModalTitle">
                <div class="modal__header">
                    <h5 id="ModalTitle">채용하기</h5>
                    <button type="button" class="modal__close" title="닫기" data-close="true">&times;</button>
                </div>

                <form id="Form" class="modal__body"
                      th:action="@{/admin/cs/recruit/register}"
                      method="post">

                    <!-- CSRF -->
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                    <div class="form-grid">

                        <!-- 제목 -->
                        <label class="form-label" for="r_title">제목</label>
                        <div class="form-field">
                            <input type="text" id="r_title" name="r_title" placeholder="채용 공고 제목 입력" required>
                        </div>

                        <!-- 채용부서 -->
                        <label class="form-label" for="r_dept">채용부서</label>
                        <div class="form-field">
                            <select id="r_dept" name="r_dept" required>
                                <option value="" hidden>채용부서 선택</option>
                                <option value="개발팀">개발팀</option>
                                <option value="디자인팀">디자인팀</option>
                                <option value="마케팅팀">마케팅팀</option>
                                <option value="영업팀">영업팀</option>
                                <option value="경영지원팀">경영지원팀</option>
                            </select>
                        </div>

                        <!-- 경력사항 -->
                        <label class="form-label" for="r_career">경력사항</label>
                        <div class="form-field">
                            <select id="r_career" name="r_career" required>
                                <option value="" hidden>경력사항 선택</option>
                                <option value="신입">신입</option>
                                <option value="경력">경력</option>
                                <option value="무관">무관</option>
                            </select>
                        </div>

                        <!-- 채용형태 -->
                        <label class="form-label" for="r_type">채용형태</label>
                        <div class="form-field">
                            <select id="r_type" name="r_type" required>
                                <option value="" hidden>채용형태 선택</option>
                                <option value="정규직">정규직</option>
                                <option value="계약직">계약직</option>
                                <option value="인턴">인턴</option>
                                <option value="아르바이트">아르바이트</option>
                            </select>
                        </div>

                        <!-- 모집기간 -->
                        <label class="form-label">모집기간</label>
                        <div class="form-field">
                            <div class="range-row">
                                <input type="date" id="r_start_date" name="r_start_date" required>
                                <span class="tilde">~</span>
                                <input type="date" id="r_end_date" name="r_end_date" required>
                            </div>
                        </div>
                    </div>

                    <div class="modal__footer">
                        <button type="button" class="btn-gray" data-close="true">취소</button>
                        <button type="submit" class="btn-green">등록하기</button>
                    </div>
                </form>

            </div>
        </div>

    </div>


    <!-- □□□□□ 메인컨텐츠 종료 □□□□□ -->
    <!-- □□□□□ 메인컨텐츠 종료 □□□□□ -->

    <script th:src="@{/js/modal.js}"></script>

    <script>
        // 전체 선택
        const chkAll = document.getElementById('chkAll');
        chkAll?.addEventListener('change', (e) => {
            document.querySelectorAll('tbody input[type="checkbox"]')
                .forEach(cb => cb.checked = e.target.checked);
        });


        //선택삭제ㅔ
        document.getElementById('btnDelete')?.addEventListener('click', async (e) => {
            e.preventDefault();
            const checked = Array.from(document.querySelectorAll('tbody input[type="checkbox"]:checked'));
            if (checked.length === 0) {
                alert('삭제할 항목을 선택하세요.');
                return;
            }

            if (!confirm(`${checked.length}개의 항목을 삭제하시겠습니까?`)) return;

            // 번호 목록 추출
            const ids = checked.map(cb => cb.closest('tr').querySelector('td:nth-child(2)').textContent.trim());

            // CSRF 토큰 추출
            const token = document.querySelector('input[name="_csrf"]').value;
            const param = document.querySelector('input[name="_csrf_parameterName"]')?.value || '_csrf';

            const res = await fetch('/admin/cs/recruit/delete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    [ 'X-CSRF-TOKEN' ]: token
                },
                body: JSON.stringify(ids)
            });

            if (res.ok) {
                alert('삭제되었습니다.');
                location.reload();
            } else {
                alert('삭제 중 오류가 발생했습니다.');
            }
        });
    </script>
</th:block>
