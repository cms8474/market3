<th:block th:fragment="content">
    <div class="config-category">
        <div class="page-breadcrumb">HOME &gt; 환경설정 &gt; 카테고리</div>
        <h2 class="page-title">카테고리</h2>

        <!-- 카테고리 카드 -->
        <section class="card">
            <div class="card-head">
                <h3>카테고리 관리</h3>
                <div class="desc">쇼핑몰 메인, 상품 페이지 사이드 카테고리 메뉴 입니다.</div>
            </div>

            <div class="card-body">
                <ul id="categoryList" class="category-list">
                    <li class="category-item" th:each="cat : ${categories}" draggable="true">
                        <span th:text="${cat.name}">여성패션</span>
                        <button type="button" class="btn-delete">삭제</button>

                        <!-- 2차 카테고리 -->
                        <ul class="subcategory-list">
                            <li class="subcategory-item"
                                th:each="sub : ${cat.sub}" draggable="true">
                                <span th:text="${sub}" >브랜드의류</span>
                                <button type="button" class="btn-delete">삭제</button>
                            </li>
                            <li class="subcategory-item"
                                draggable="true">
                                <span th:text="${sub}" >브랜드가방</span>
                                <button type="button" class="btn-delete">삭제</button>
                            </li>
                            <li class="subcategory-item"
                                th:each="sub : ${cat.sub}" draggable="true">
                                <span th:text="${sub}" >브랜드신발</span>
                                <button type="button" class="btn-delete">삭제</button>
                            </li>
                            <li class="subcategory-item"
                                th:each="sub : ${cat.sub}" draggable="true">
                                <span th:text="${sub}" >브랜드잡화</span>
                                <button type="button" class="btn-delete">삭제</button>
                            </li>
                        </ul>
                        <button type="button" class="btn ghost">+ 2차 카테고리 추가</button>
                    </li>

                    <li class="category-item">
                        <span>남성패션</span>
                        <button type="button" class="btn-delete">삭제</button>
                    </li>

                    <li class="category-item">
                        <span>식품</span>
                        <button type="button" class="btn-delete">삭제</button>
                    </li>

                    <li class="category-item">
                        <span>생활 / 건강</span>
                        <button type="button" class="btn-delete">삭제</button>
                    </li>

                    <li class="category-item">
                        <span>유아동</span>
                        <button type="button" class="btn-delete">삭제</button>
                    </li>

                    <li class="category-item">
                        <span>가전</span>
                        <button type="button" class="btn-delete">삭제</button>
                    </li>
                </ul>
                <button type="button" class="btn ghost">+ 1차 카테고리 추가</button>
            </div>

            <div class="card-foot">
                <button type="submit" class="btn primary">수정하기</button>
            </div>
        </section>
    </div>

    <!-- 드래그 앤 드롭 + 삭제 확인 -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script>
        // 1차 카테고리 드래그앤드롭
        new Sortable(document.getElementById('categoryList'), {
            animation: 150,
            ghostClass: 'dragging'
        });

        // 모든 2차 카테고리에 대해 드래그앤드롭 적용
        document.querySelectorAll('.subcategory-list').forEach(el => {
            new Sortable(el, {
                animation: 150,
                ghostClass: 'dragging'
            });
        });

        // 삭제 버튼 (확인창)
        document.addEventListener('click', function(e){
            if(e.target.classList.contains('btn-delete')){
                if(confirm("정말 삭제하시겠습니까?")) {
                    const li = e.target.closest('li');
                    const name = li.querySelector('span').innerText;

                    fetch('/admin/config/category/delete', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: 'name=' + encodeURIComponent(name)
                    }).then(res => res.json())
                        .then(data => {
                            if(data.status === 'deleted'){
                                li.remove();
                            }
                        });
                }
            }
        });
    </script>
</th:block>
