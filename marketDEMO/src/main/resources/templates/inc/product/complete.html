<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>주문완료</title>
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/sidebar.css">
    <link rel="stylesheet" href="/css/product.css">
</head>
<body>
<th:block th:replace="~{inc/_header :: _header}"/>
<main class="product-page">
    <div class="main-container">

        <div class="sidebar-container">
            <th:block th:replace="~{inc/_sidebar :: _sidebar}"/>
            <aside class="best-product-list">
                <h3 class="page-title">베스트 상품</h3>
                <ul class="products">
                    <li class="best-product-item">
                        <img th:src="@{/images/logo.png}" alt="베스트 상품">
                        <div class="info">
                            <h4 class="name">상품명</h4>
                            <p class="price">
                                <span class="origin">30,000원</span>
                                <span class="discount">10% ↓</span>
                                <span class="sale">27,000원</span>
                            </p>
                        </div>
                    </li>
                    <li class="best-product-item">
                        <img th:src="@{/images/logo.png}" alt="베스트 상품">
                        <div class="info">
                            <h4 class="name">상품명</h4>
                            <p class="price">
                                <span class="origin">30,000원</span>
                                <span class="discount">10% ↓</span>
                                <span class="sale">27,000원</span>
                            </p>
                        </div>
                    </li>
                    <li class="best-product-item">
                        <img th:src="@{/images/logo.png}" alt="베스트 상품">
                        <div class="info">
                            <h4 class="name">상품명</h4>
                            <p class="price">
                                <span class="origin">30,000원</span>
                                <span class="discount">10% ↓</span>
                                <span class="sale">27,000원</span>
                            </p>
                        </div>
                    </li>
                </ul>
            </aside>
        </div>

        <!-- ✅ 주문완료 본문 -->
        <section class="order-complete" style="flex:1;">

            <!-- 상단 제목 + breadcrumb -->
            <div class="title-bar" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                <h2 class="page-title" style="font-size:20px; font-weight:700; border-bottom:2px solid #222; padding-bottom:8px; margin:0;">주문완료</h2>
                <nav class="breadcrumb" style="font-size:13px; color:#666;">HOME &gt; 주문하기 &gt; 주문완료</nav>
            </div>

            <!-- 안내 문구 -->
            <div class="complete-msg" style="text-align:center; padding:20px; border:1px solid #ddd; margin-bottom:20px; background:#fafafa;">
                <h3 style="font-size:18px; margin:0 0 10px;">고객님의 주문이 정상적으로 완료되었습니다.</h3>
                <p style="font-size:14px; color:#555;">즐거운 쇼핑이 되셨나요? 항상 고객님을 위한 케이마켓이 되겠습니다.</p>
            </div>

            <!-- 주문상품 -->
            <div class="order-box" style="border:1px solid #ccc; margin-bottom:20px;">
                <h4 style="background:#f7f7f7; padding:10px; font-size:15px; font-weight:700; border-bottom:1px solid #ccc;">주문상품</h4>
                <table style="width:100%; border-collapse:collapse; font-size:14px;">
                    <thead>
                    <tr style="background:#fcfcfc; border-bottom:1px solid #eee;">
                        <th style="padding:10px; text-align:left;">상품명</th>
                        <th style="padding:10px;">판매가</th>
                        <th style="padding:10px;">할인</th>
                        <th style="padding:10px;">수량</th>
                        <th style="padding:10px;">주문금액</th>
                    </tr>
                    </thead>
                    <tbody>
                    <th:block th:each="cartItem : ${cartItems}">
                        <!-- 메인 상품 행 -->
                        <tr style="border-bottom:1px solid #eee; text-align:center;">
                            <td style="padding:10px; text-align:left;" th:text="${productMap[cartItem.ciPPid] != null ? productMap[cartItem.ciPPid].pName : cartItem.ciPPid}">상품명</td>
                            <td th:text="${productMap[cartItem.ciPPid] != null ? #numbers.formatInteger(productMap[cartItem.ciPPid].pPrice, 0, 'COMMA') : '0'}">판매가</td>
                            <td th:text="${productMap[cartItem.ciPPid] != null and productMap[cartItem.ciPPid].pDiscount != null and productMap[cartItem.ciPPid].pDiscount > 0 ? '-' + #numbers.formatInteger((productMap[cartItem.ciPPid].pPrice * cartItem.ciAmount * productMap[cartItem.ciPPid].pDiscount / 100), 0, 'COMMA') : '0'}">할인금액</td>
                            <td th:text="${cartItem.ciAmount}">수량</td>
                            <td style="color:#d32f2f; font-weight:700;" th:text="${#numbers.formatInteger(cartItem.ciTotPrice, 0, 'COMMA')}">주문금액</td>
                        </tr>
                        
                        <!-- 옵션 행들 -->
                        <tr th:if="${cartItem.ciOp01 != null and cartItem.ciOp01 != ''}" style="border-bottom:1px solid #eee; text-align:center; background-color: #f9f9f9;">
                            <td style="padding:10px; text-align:left; padding-left: 30px; font-size: 13px; color: #666;">
                                <span th:text="${optionMap[cartItem.ciOp01] != null ? optionMap[cartItem.ciOp01].popName + ': ' + optionMap[cartItem.ciOp01].popSelection : '옵션1: ' + cartItem.ciOp01}">옵션1</span>
                            </td>
                            <td th:text="${optionMap[cartItem.ciOp01] != null and optionMap[cartItem.ciOp01].popAddPrice != null ? #numbers.formatInteger(optionMap[cartItem.ciOp01].popAddPrice, 0, 'COMMA') : '0'}">옵션가격</td>
                            <td>0</td>
                            <td th:text="${cartItem.ciAmount}">수량</td>
                            <td style="color:#d32f2f; font-weight:700;" th:text="${optionMap[cartItem.ciOp01] != null and optionMap[cartItem.ciOp01].popAddPrice != null ? #numbers.formatInteger(optionMap[cartItem.ciOp01].popAddPrice * cartItem.ciAmount, 0, 'COMMA') : '0'}">옵션금액</td>
                        </tr>
                        
                        <tr th:if="${cartItem.ciOp02 != null and cartItem.ciOp02 != ''}" style="border-bottom:1px solid #eee; text-align:center; background-color: #f9f9f9;">
                            <td style="padding:10px; text-align:left; padding-left: 30px; font-size: 13px; color: #666;">
                                <span th:text="${optionMap[cartItem.ciOp02] != null ? optionMap[cartItem.ciOp02].popName + ': ' + optionMap[cartItem.ciOp02].popSelection : '옵션2: ' + cartItem.ciOp02}">옵션2</span>
                            </td>
                            <td th:text="${optionMap[cartItem.ciOp02] != null and optionMap[cartItem.ciOp02].popAddPrice != null ? #numbers.formatInteger(optionMap[cartItem.ciOp02].popAddPrice, 0, 'COMMA') : '0'}">옵션가격</td>
                            <td>0</td>
                            <td th:text="${cartItem.ciAmount}">수량</td>
                            <td style="color:#d32f2f; font-weight:700;" th:text="${optionMap[cartItem.ciOp02] != null and optionMap[cartItem.ciOp02].popAddPrice != null ? #numbers.formatInteger(optionMap[cartItem.ciOp02].popAddPrice * cartItem.ciAmount, 0, 'COMMA') : '0'}">옵션금액</td>
                        </tr>
                    </th:block>
                    </tbody>
                </table>
                <div style="padding:12px; text-align:right; font-size:14px; line-height:1.6; background:#fafafa;">
                    총 상품금액 <strong th:text="${#numbers.formatInteger(productAmount, 0, 'COMMA')} + '원'">상품금액</strong><br>
                    할인금액 <strong th:text="'-' + ${#numbers.formatInteger(discountAmount, 0, 'COMMA')} + '원'" th:if="${discountAmount > 0}">할인금액</strong><strong th:text="'0원'" th:if="${discountAmount <= 0}">0원</strong><br>
                    배송비 <strong th:text="${deliveryFee > 0 ? #numbers.formatInteger(deliveryFee, 0, 'COMMA') + '원' : '무료'}" th:if="${deliveryFee > 0}">배송비</strong><strong th:text="'무료'" th:if="${deliveryFee <= 0}">무료</strong><br>
                    <span style="font-size:16px; font-weight:700; color:#d32f2f;">= 최종 결제금액 <span th:text="${#numbers.formatInteger(finalAmount, 0, 'COMMA')} + '원'">최종금액</span></span>
                </div>
            </div>

            <!-- 주문정보 -->
            <div class="order-box" style="border:1px solid #ccc; margin-bottom:20px;">
                <h4 style="background:#f7f7f7; padding:10px; font-size:15px; font-weight:700; border-bottom:1px solid #ccc;">주문정보</h4>
                <table style="width:100%; border-collapse:collapse; font-size:14px;">
                    <tbody>
                    <tr style="border-bottom:1px solid #eee;">
                        <th style="width:150px; text-align:left; padding:10px; background:#fcfcfc;">주문번호</th>
                        <td style="padding:10px;" th:text="${orderNumber}">주문번호</td>
                    </tr>
                    <tr style="border-bottom:1px solid #eee;">
                        <th style="padding:10px; background:#fcfcfc; text-align:left;">결제방법</th>
                        <td style="padding:10px;">무통장입금</td>
                    </tr>
                    <tr>
                        <th style="padding:10px; background:#fcfcfc; text-align:left;">결제금액</th>
                        <td style="padding:10px; font-weight:700; color:#d32f2f;" th:text="${#numbers.formatInteger(finalAmount, 0, 'COMMA')} + '원'">결제금액</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- 배송정보 -->
            <div class="order-box" style="border:1px solid #ccc;">
                <h4 style="background:#f7f7f7; padding:10px; font-size:15px; font-weight:700; border-bottom:1px solid #ccc;">배송정보</h4>
                <table style="width:100%; border-collapse:collapse; font-size:14px;">
                    <tbody>
                    <tr style="border-bottom:1px solid #eee;">
                        <th style="width:150px; text-align:left; padding:10px; background:#fcfcfc;">수령인</th>
                        <td style="padding:10px;" th:text="${deliveryRecipient}">수령인</td>
                    </tr>
                    <tr style="border-bottom:1px solid #eee;">
                        <th style="padding:10px; background:#fcfcfc; text-align:left;">연락처</th>
                        <td style="padding:10px;" th:text="${deliveryPhone}">연락처</td>
                    </tr>
                    <tr style="border-bottom:1px solid #eee;">
                        <th style="padding:10px; background:#fcfcfc; text-align:left;">배송지 주소</th>
                        <td style="padding:10px;" th:text="${deliveryPostal + ' ' + deliveryBaseAddr + ' ' + deliveryDetailAddr}">배송지 주소</td>
                    </tr>
                    <tr th:if="${deliveryRequest != null and deliveryRequest != ''}">
                        <th style="padding:10px; background:#fcfcfc; text-align:left;">배송 요청사항</th>
                        <td style="padding:10px;" th:text="${deliveryRequest}">배송 요청사항</td>
                    </tr>
                    </tbody>
                </table>
            </div>

        </section>
    </div>
</main>

<!-- 공통 푸터 -->
<th:block th:replace="~{inc/_footer :: _footer}"/>

</body>
</html>
